<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="bower_components/chart.js/dist/Chart.js"></script>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker3.standalone.css">
    <style>
        body {
            padding-top: 50px;
        }
        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }
    </style>
</head>
<body>
<!--[if lte IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade
    your browser</a> to improve your experience and security.</p>
<![endif]-->


<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Satisfaction</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <form class="navbar-form navbar-right">
                <!--<div class="form-group">-->
                    <!--<input id="txtDesde" name="txtDesde" type="text" placeholder="01/01/2017" class="form-control">-->
                <!--</div>-->
                <!--<div class="form-group">-->
                    <!--<input id="txtHasta" name="txtHasta" type="text" placeholder="31/12/2018" class="form-control">-->
                <!--</div>-->
                <div class="form-group">
                    <div class="input-group input-daterange">
                        <input id="startTimestamp" type="text" class="form-control" value="2012-04-05">
                        <div class="input-group-addon">to</div>
                        <input id="endTimestamp" type="text" class="form-control" value="2012-04-19">
                    </div>
                </div>
                <button id="cmdEguneratu" type="submit" class="btn btn-success">Eguneratu</button>
            </form>
        </div><!--/.navbar-collapse -->
    </div>
</nav>

<div class="container">

    <div class="starter-template">

        <div id="container">

            <div class="bs-example bs-example-tabs" data-example-id="togglable-tabs">

                <ul class="nav nav-tabs" id="myTabs" role="tablist">

                    <li role="presentation" class="active">
                        <a href="#home" id="home-tab" role="tab" data-toggle="tab" aria-controls="home" aria-expanded="true">TOTALAK</a></li>
                    <li role="presentation">
                        <a href="#trintxerpe" role="tab" id="trintxerpe-tab" data-toggle="tab" aria-controls="profile">Trintxerpe</a>
                    </li>
                    <li role="presentation">
                        <a href="#antxo" role="tab" id="antxo-tab" data-toggle="tab" aria-controls="profile">Antxo</a>
                    </li>
                    <li role="presentation">
                        <a href="#donibane" role="tab" id="donibane-tab" data-toggle="tab" aria-controls="profile">Donibane</a>
                    </li>

                </ul>

                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade in active" role="tabpanel" id="home" aria-labelledby="home-tab">
                        <div class="row">&nbsp;</div>
                        <div class="row">
                            <div class="col-md-6">
                                <legend>Guztira auzoko</legend>
                                <canvas id="myChart1"></canvas>
                            </div>
                            <div class="col-md-6">
                                <legend>Emaitzak guztira</legend>
                                <canvas id="myChartPie"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" role="tabpanel" id="trintxerpe" aria-labelledby="profile-tab">
                        <div class="row">&nbsp;</div>
                        <div class="row">
                            <div class="col-md-6">
                                <canvas id="chartTrintxerpe" width="400" height="400"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" role="tabpanel" id="antxo" aria-labelledby="dropdown1-tab">
                        <div class="row">&nbsp;</div>
                        <div class="row">
                            <div class="col-md-6">
                                <canvas id="chartAntxo" width="400" height="400"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" role="tabpanel" id="donibane" aria-labelledby="dropdown2-tab">
                        <div class="row">&nbsp;</div>
                        <div class="row">
                            <div class="col-md-6">
                                <canvas id="chartDonibane" width="400" height="400"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>






        </div>


    </div>

</div><!-- /.container -->
<script src="js/vendor/modernizr-3.5.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-3.2.1.min.js"><\/script>')</script>
<script src="js/plugins.js"></script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<script src="bower_components/bootstrap-datepicker/dist/locales/bootstrap-datepicker.eu.min.js"></script>
<script src="js/main.js"></script>

<script>

    window.chartColors = {
        red: 'rgb(255, 99, 132)',
        orange: 'rgb(255, 159, 64)',
        yellow: 'rgb(255, 205, 86)',
        green: 'rgb(75, 192, 192)',
        blue: 'rgb(54, 162, 235)',
        purple: 'rgb(153, 102, 255)',
        grey: 'rgb(201, 203, 207)'
    };

    function drawLineChart() {

        var jsonData = $.ajax({
            url: 'http://localhost:3000/satisfaction',
            dataType: 'json',
        }).done(function (results) {
            var aTrintxerpen1 = 0;
            var aTrintxerpen0 = 0;
            var aTrintxerpen_1 = 0;

            var aAntxon1 = 0;
            var aAntxon0 = 0;
            var aAntxon_1 = 0;

            var aDonibanen1 = 0;
            var aDonibanen0 = 0;
            var aDonibanen_1 = 0;

            results.forEach(function (d) {

                if (d.kokapena === "Trintxerpe") {

                    if (d.emaitza === 1) {
                        aTrintxerpen1 = aTrintxerpen1 + 1;
                    } else if (d.emaitza === 0) {
                        aTrintxerpen0 = aTrintxerpen0 + 1;
                    } else {
                        aTrintxerpen_1 = aTrintxerpen_1 + 1;
                    }

                } else if (d.kokapena === "Antxo") {

                    if (d.emaitza === 1) {
                        aAntxon1 = aAntxon1 + 1;
                    } else if (d.emaitza === 0) {
                        aAntxon0 = aAntxon0 + 1;
                    } else {
                        aAntxon_1 = aAntxon_1 + 1;
                    }

                } else {

                    if (d.emaitza === 1) {
                        aDonibanen1 = aDonibanen1 + 1;
                    } else if (d.emaitza === 0) {
                        aDonibanen0 = aDonibanen0 + 1;
                    } else {
                        aDonibanen_1 = aDonibanen_1 + 1;
                    }

                }
            });
            var o1 = {
                label: "Ongi",
                data: [],
                backgroundColor: window.chartColors.green,
            };
            o1.data.push(aTrintxerpen1);
            o1.data.push(aAntxon1);
            o1.data.push(aDonibanen1);

            var o2 = {
                label: "Erdipurdi",
                data: [],
                backgroundColor: window.chartColors.blue,
            };
            o2.data.push(aTrintxerpen0);
            o2.data.push(aAntxon0);
            o2.data.push(aDonibanen0);

            var o3 = {
                label: "Gaizki",
                data: [],
                backgroundColor: window.chartColors.red,
            };
            o3.data.push(aTrintxerpen_1);
            o3.data.push(aAntxon_1);
            o3.data.push(aDonibanen_1);

            // Create the chart.js data structure using 'labels' and 'data'
            var tempData = {
                labels: ["Trintxerpe", "Antxo", "Donibane"],
                datasets: []
            };
            tempData.datasets.push(o1);
            tempData.datasets.push(o2);
            tempData.datasets.push(o3);

            var ctx = document.getElementById("myChart1").getContext("2d");
            var myLineChart = new Chart(ctx, {
                type: 'bar',
                data: tempData,
                options: {
                    responsive: true,
                    scales: {
                        xAxes: [{
                            stacked: true,
                        }],
                        yAxes: [{
                            stacked: true
                        }]
                    }
                }
            });


            /**********************GAZTA ******************/

            var config = {
                type: 'pie',
                data: {
                    datasets: [],
                    labels: ["Ongi","Erdipurdi", "Gaizki"],
                },
                options: {
                    responsive: true
                }
            };

            var s1 = aTrintxerpen1 + aAntxon1 + aDonibanen1;
            var s2 = aTrintxerpen0 + aAntxon0 + aDonibanen0;
            var s3 = aTrintxerpen_1 + aAntxon_1 + aDonibanen_1;

            var t = {
                backgroundColor: [],
                data: [],
                label: "11"
            };
            t.backgroundColor.push(window.chartColors.green);
            t.data.push(s1);
            t.backgroundColor.push(window.chartColors.blue);
            t.data.push(s2);
            t.backgroundColor.push(window.chartColors.red);
            t.data.push(s3);
            config.data.datasets.push(t);




            var ctxPie = document.getElementById("myChartPie").getContext("2d");
            var myLineChart2 = new Chart(ctxPie, config);

            /***********************************************************************************************************
             ***** Tab Trintxerpe **************************************************************************************
             **********************************************************************************************************/
            var config = {
                type: 'pie',
                data: {
                    datasets: [],
                    labels: ["Ongi","Erdipurdi", "Gaizki"],
                },
                options: {
                    responsive: true
                }
            };

            var t = {
                backgroundColor: [],
                data: [],
                label: "11"
            };
            t.backgroundColor.push(window.chartColors.green);
            t.data.push(aTrintxerpen1);
            t.backgroundColor.push(window.chartColors.blue);
            t.data.push(aTrintxerpen0);
            t.backgroundColor.push(window.chartColors.red);
            t.data.push(aTrintxerpen_1);
            config.data.datasets.push(t);

            console.log(config);

            var ctx2 = document.getElementById("chartTrintxerpe").getContext("2d");
            var myLineChart2 = new Chart(ctx2, config);

            /***********************************************************************************************************
             ***** Fin Tab Trintxerpe **********************************************************************************
             **********************************************************************************************************/

            /***********************************************************************************************************
             ***** Tab Antxo  ******************************************************************************************
             **********************************************************************************************************/
            var config = {
                type: 'pie',
                data: {
                    datasets: [],
                    labels: ["Ongi","Erdipurdi", "Gaizki"],
                },
                options: {
                    responsive: true
                }
            };

            var t = {
                backgroundColor: [],
                data: [],
                label: "11"
            };
            t.backgroundColor.push(window.chartColors.green);
            t.data.push(aAntxon1);
            t.backgroundColor.push(window.chartColors.blue);
            t.data.push(aAntxon0);
            t.backgroundColor.push(window.chartColors.red);
            t.data.push(aAntxon_1);
            config.data.datasets.push(t);

            var ctx3 = document.getElementById("chartAntxo").getContext("2d");
            var myLineChart3 = new Chart(ctx3, config);

            /**********************************************************************************************************
             ***** Fin Tab Antxo  *************************************************************************************
             **********************************************************************************************************/

            /***********************************************************************************************************
             ***** Tab Donibane  ******************************************************************************************
             **********************************************************************************************************/
            var config = {
                type: 'pie',
                data: {
                    datasets: [],
                    labels: ["Ongi","Erdipurdi", "Gaizki"],
                },
                options: {
                    responsive: true
                }
            };

            var t = {
                backgroundColor: [],
                data: [],
                label: "11"
            };
            t.backgroundColor.push(window.chartColors.green);
            t.data.push(aDonibanen1);
            t.backgroundColor.push(window.chartColors.blue);
            t.data.push(aDonibanen0);
            t.backgroundColor.push(window.chartColors.red);
            t.data.push(aDonibanen_1);
            config.data.datasets.push(t);

            var ctx3 = document.getElementById("chartDonibane").getContext("2d");
            var myLineChart3 = new Chart(ctx3, config);

            /**********************************************************************************************************
             ***** Fin Tab Antxo  *************************************************************************************
             **********************************************************************************************************/

        });
    }



    $(document).ready(function () {
        $('.input-daterange input').each(function() {
            $(this).datepicker();
        });

//        $('.datepicker-to-from').dateRangePicker({
//            format: 'MM/DD/YYYY HH:mm',
//            showShortcuts: false,
//            time: {
//                enabled: true
//            }
//        });

//        // get values and create Date objects
//        var date1 = new Date();
//        var date2 = new Date();
//
//        // set the values
//        $('#startTimestamp').val(date1);
//        $('#endTimestamp').val(date2);

        drawLineChart();

        $("#cmdEguneratu").click(function () {
            drawLineChart();
        });
    });


</script>
</body>
</html>
